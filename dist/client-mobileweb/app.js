var http=http||{};
http.Factory=http.Factory||function(){return{create:function(b){var b=b||{},d=b.timeout||6E4,a=b.onload||function(){},c=b.onerror||function(){},e=b.onprogress||function(){},b=b.ontimeout||function(){};if("undefined"!==typeof XDomainRequest){var f=new XDomainRequest;f.timeout=d;f.onload=function(){f.fix=!0;a()};f.onerror=c;f.onprogress=e;f.ontimeout=b;f.setRequestHeader=function(){};f.setUserAgent=function(){};return f}if("undefined"!==typeof XMLHttpRequest){var g=new XMLHttpRequest;g.timeout=d;g.onload=
a;g.onerror=c;g.onprogress=e;g.ontimeout=b;g.setUserAgent=function(){};return g}if("undefined"!==typeof Ti){var h=Ti.Network.createHTTPClient({timeout:d,onload:a,onerror:c,onprogress:e,ontimeout:b});h.setUserAgent=function(a){h.setRequestHeader("User-Agent",a)};return h}throw Error("Could not find an HttpClient implementation.");}}}();http.create=http.create||http.Factory.create;var lineapp=lineapp||{};
lineapp.Client=lineapp.Client||function(b){return function(d){var d=d||{},a=d.apiUrl||"https://lineapp-prod.appspot.com/v1.0",d={},c=new lineapp.Protocol;d.request=function(d){d=d||{};c.post({url:a,obj:d.request||null,callback:d.callback||function(){}})};return d}(b)};lineapp=lineapp||{};
lineapp.EventHub=lineapp.EventHub||function(){return function(){var b={},d={};b.addEventListener=function(a,c){var b=d[a];"undefined"===typeof b&&(b=[],d[a]=b);b.push(c)};b.removeEventListener=function(a,b){var e=d[a];if("undefined"!==typeof e){var f=e.indexOf(b);-1!==f&&e.splice(f,1);0==e.length&&delete d[a]}};b.removeAllListeners=function(){d={}};b.addGeneralEventListener=function(a){b.addEventListener("__all__",a)};b.removeGeneralEventListener=function(a){b.removeEventListener("__all__",a)};b.fireEvent=
function(a,b){var e=d[a];if("undefined"!==typeof e)for(var f=0,g=e.length;f<g;++f)e[f](b);e=d.__all__;if("undefined"!==typeof e){f=0;for(g=e.length;f<g;++f)e[f](a,b)}};b.getNumListeners=function(){var a=0,b;for(b in d)a+=d[b].length;return a};return b}()};lineapp=lineapp||{};
lineapp.LineAppService=lineapp.LineAppService||function(){var b=new lineapp.EventHub,d=null;b.request=function(a){var a=a||{},b=a.request||{},e=a.promise||new utils.Promise;if(a.callback){var f=a.callback;e.done(function(){f.apply(this,arguments)})}d.request({request:b,callback:function(a){e.resolve(a)}})};b.init=function(a){a=a||{};d=a.client||null};return b}();lineapp=lineapp||{};
lineapp.LineManagement=lineapp.LineManagement||function(b){return function(){function b(a){switch(a.type){case "join":e.NORMAL.push({id:a.clientId,ask:c,joinTimestamp:a.timestamp});break;default:console.warn("Unkown event type",a)}}var a=new lineapp.EventHub,c=500,e={};a.init=function(a){a=a.events;"create"!==a.shift().type?alert("First event is not create!"):(e={NORMAL:[],VIP:[]},_.each(a,b))};a.handleEvents=function(c){_.each(c,b);a.fireEvent("changed",{events:c})};a.getLines=function(){return e};
return a}(b)};lineapp=lineapp||{};lineapp.getDefaultUserAgent=function(){return"lineapp4js (gzip)"};
lineapp.Protocol=lineapp.Protocol||function(b){return function(b){var b=b||{},a=b.userAgent||lineapp.getDefaultUserAgent();return{post:function(b){var d=b.url||null,f=b.obj||null,g=b.callback||function(){},h=http.create({onload:function(){g(JSON.parse(h.responseText))},onerror:function(){g({error:{code:"protocol",message:"protocol error"}})},timeout:b.timeout||6E4});h.open("POST",d);h.setUserAgent(a);h.setRequestHeader("Content-Type","application/json");h.setRequestHeader("Accept","application/json");
h.send(JSON.stringify(f))}}}(b)};var utils=utils||{};utils.Promise=utils.Promise||function(){function b(){if(d)for(;0<a.length;)a.pop().apply(this,c)}var d=!1,a=[],c;this.done=function(d){a.push(d);b();return this};this.resolve=function(){c=_.toArray(arguments);d=!0;b()};this.isResolved=function(){return d};this.getValue=function(){return c};return this};
utils.Promise.when=function(){function b(){d||_.all(_.invoke(a,"isResolved"))&&c.resolve.apply(this,_.map(a,function(a){return a.getValue()[0]}))}var d=!1,a=[],c=new utils.Promise;_.each(arguments,function(d){var c=(new utils.Promise).done(b);a.push(c);d=d(c);d instanceof utils.Promise&&d.done(function(a){c.resolve(a)})});return c};lineapp=lineapp||{};
lineapp.Facebook="undefined"!==typeof FB?lineapp.Facebook||function(){function b(){e=c=null;a.fireEvent("logout")}function d(b){a.login(b.userID,b.accessToken)}var a=new lineapp.EventHub,c=null,e=null,f=!1,g=null;a.init=function(a){var a=a||{},c=a.channelUrl||null;g=a.appId||null;f=a.dontUseFB||!1;f||(FB.init({appId:g,channelUrl:c,status:!0,cookie:!0,xfbml:!0,oauth:!0}),FB.getLoginStatus(function(a){a.authResponse?d(a.authResponse):b()}))};a.getLoggedIn=function(){return null!==c};a.getAccessToken=
function(){return c};a.authorize=function(){f||FB.login(function(a){a.authResponse?d(a.authResponse):b()},void 0)};a.getUid=function(){return e};a.logout=function(){f?b():FB.logout()};a.getGraphPath=function(b,d,c){var e=http.create({onload:function(){c({success:!0,result:e.responseText})},onerror:function(a){c({error:!0,event:a})}}),b="https://graph.facebook.com/"+b,d=new lineapp.QueryStringBuilder(d);d.append("access_token",a.getAccessToken());b+=d.toString();e.autoEncodeUrl=!1;e.open("GET",b);
e.send()};a.login=function(b,d){c=d;e=b;a.fireEvent("login",{success:!0});lineapp.LineAppService.request({request:{type:"extend",accessToken:c,fbAppId:g},callback:function(a){a.error||(c=a.value.accessToken)}})};FB.Event.subscribe("auth.login",function(a){d(a.authResponse)});FB.Event.subscribe("auth.logout",function(){b()});return a}():lineapp.Facebook||function(){var b=new lineapp.EventHub;b.init=function(){};b.getLoggedIn=function(){return!1};b.getAccessToken=function(){return null};b.authorize=
function(){};b.getUid=function(){return null};b.logout=function(){};b.getGraphPath=function(b,a,c){c({error:!0})};return b}();lineapp=lineapp||{};lineapp.GetInLinePresenter=lineapp.GetInLinePresenter||function(b){return function(){var b=new lineapp.EventHub,a=new lineapp.GetInLineView;a.addEventListener("lineup",function(a){b.fireEvent("lineup",a)});b.getView=function(){return a};return b}(b)};lineapp=lineapp||{};
lineapp.InLinePresenter=lineapp.InLinePresenter||function(b){return function(b){var a=new lineapp.EventHub,c=b.lineManagement,b=new lineapp.InLineConfigPresenter({lineManagement:c}),c=new lineapp.InLineLinePresenter({lineManagement:c}),e=new lineapp.InLineView;e.addConfigView(b.getView());e.addLineView(c.getView());a.getView=function(){return e};return a}(b)};lineapp=lineapp||{};
lineapp.InLineConfigPresenter=lineapp.InLineConfigPresenter||function(b){return function(b){var a=new lineapp.EventHub,c=b.lineManagement,e=new lineapp.InLineConfigView;a.update=function(){var a=c.getLines();_.each(a,function(a){_.each(a,function(a,b){a.id===lineapp.Facebook.getUid()&&(e.setPosition(b+1),e.setTimeInLine(a.joinTimestamp),e.setAsk(a.ask),e.setEta(1E3),e.setTotalEarned(0))})})};a.update();a.getView=function(){return e};return a}(b)};
lineapp.InLineLinePresenter=lineapp.InLineLinePresenter||function(b){return function(b){var a=new lineapp.EventHub,b=b.lineManagement,c=new lineapp.InLineLineView;c.initLines(b.getLines());a.getView=function(){return c};return a}(b)};lineapp=lineapp||{};
lineapp.LineAppPresenter=lineapp.LineAppPresenter||function(b){return function(){function b(){if(h)console.warn("onLogin >> called twice.");else{h=!0;console.log("onLogin >> Start.");var d=[{type:"create",vipPrice:1E4,israeliMode:!1},{type:"join",clientId:lineapp.Facebook.getUid(),timestamp:1391694080889},{type:"join",clientId:1,timestamp:1391694080889},{type:"join",clientId:2,timestamp:1391694080889},{type:"join",clientId:3,timestamp:1391694080889},{type:"join",clientId:4,timestamp:1391694080889}];
console.log("onEvents >> Start.",d);g.init({events:d});d=_.values(g.getLines());d=_.chain(d).flatten().pluck("id").contains(lineapp.Facebook.getUid()).value();console.log("onEvents >> inLine",d);d?c():a()}}function a(){var a=new lineapp.GetInLinePresenter;f.showGetInLineView(a.getView());a.addEventListener("lineup",function(){_.defer(function(){g.handleEvents([{type:"join",clientId:lineapp.Facebook.getUid(),timestamp:1391694080889}]);c()})})}function c(){var a=new lineapp.InLinePresenter({lineManagement:g});
f.showInLineView(a.getView())}var e=new lineapp.EventHub,f=new lineapp.LineAppView,g=new lineapp.LineManagement;e.open=function(){console.log("open >> Start.");lineapp.Facebook.getLoggedIn()?(console.log("open >> Already logged in."),b()):(console.log("open >> Logging in."),lineapp.Facebook.addEventListener("login",function(a){console.log("open >> Logged in.",a);b()}),lineapp.Facebook.authorize())};var h=!1;e.getView=function(){return f};return e}(b)};lineapp=lineapp||{};
lineapp.GetInLineView=lineapp.GetInLineView||function(b){return function(){var b=new lineapp.EventHub,a=$("<div></div>");$("<button></button>").html("Get In Line!").appendTo(a).on("click",function(){b.fireEvent("lineup")});b.getDom=function(){return a};return b}(b)};lineapp=lineapp||{};
lineapp.InLineConfigView=lineapp.InLineConfigView||function(b){return function(){function b(){if(e){var d=(new Date).getTime()-e,d=parseInt(d/1E3),c=parseInt(d/60/60),f=parseInt(d/60)-60*c,d=d-60*f-3600*c;h.html(a(c)+":"+a(f)+":"+a(d))}}function a(a){a=""+a;1===a.length&&(a="0"+a);return a}var c=new lineapp.EventHub,e=null,f=$("<div></div>"),g=$("<div></div>",{"class":"position"}).appendTo(f),h=$("<div></div>",{"class":"timeinline"}).appendTo(f),j=$("<div></div>",{"class":"timeeta"}).appendTo(f),
i=$("<select></select>").appendTo(f),k=$("<div></div>").appendTo(f);$("<option></option>",{value:100,html:"$1"}).appendTo(i);$("<option></option>",{value:200,html:"$2"}).appendTo(i);$("<option></option>",{value:300,html:"$3"}).appendTo(i);$("<option></option>",{value:400,html:"$4"}).appendTo(i);$("<option></option>",{value:500,html:"$5"}).appendTo(i);$("<option></option>",{value:1E3,html:"$10"}).appendTo(i);$("<option></option>",{value:1500,html:"$15"}).appendTo(i);$("<option></option>",{value:2E3,
html:"$20"}).appendTo(i);c.setPosition=function(a){g.html(a)};c.setTimeInLine=function(a){e=a;b()};c.setEta=function(a){j.html(a)};c.setAsk=function(a){i.val(a)};c.setTotalEarned=function(a){k.val(a)};c.getDom=function(){return f};setInterval(b,1E3);return c}(b)};lineapp=lineapp||{};
lineapp.InLineLineView=lineapp.InLineLineView||function(b){return function(){function b(a){var d=$("<div></div>",{"class":"spotsaver"}).appendTo(h);_.defer(function(){var b=$("<div></div>",{"class":"vip"}).css({left:d.position().left+5}).appendTo(h);e[a.id]=b})}function a(a){var b=$("<div></div>",{"class":"spotsaver"}).appendTo(j);_.defer(function(){var d=$("<div></div>",{"class":"normal"}).css({left:b.position().left+5}).appendTo(j);e[a.id]=d})}var c=new lineapp.EventHub,e={},f=$("<div></div>",{"class":"lineapp_inlinelineview_wrapper"}),
g=$("<div></div>",{"class":"waitingline"}).appendTo(f);$("<div></div>",{"class":"desk"}).appendTo(g);var h=$("<div></div>",{"class":"vipline"}).appendTo(g),j=$("<div></div>",{"class":"normalline"}).appendTo(g);c.initLines=function(c){h.empty();j.empty();e={};g.css({width:55+55*(c.VIP.length+c.NORMAL.length)});_.each(c.VIP,function(a){b(a)});_.each(c.NORMAL,function(b){a(b)})};c.swap=function(a){var b=e[a.id1],a=e[a.id2];b.animate({left:a.css("left"),duration:1E3});a.animate({left:b.css("left"),duration:1E3})};
XXXX=c.swap;c.getDom=function(){return f};return c}(b)};lineapp=lineapp||{};lineapp.InLineView=lineapp.InLineView||function(b){return function(){var b=new lineapp.EventHub,a=$("<div></div>",{"class":"lineapp_inlineview_wrapper"}),c=$("<div></div>",{"class":"config"}).appendTo(a),e=$("<div></div>",{"class":"line"}).appendTo(a);b.addConfigView=function(a){c.append(a.getDom())};b.addLineView=function(a){e.append(a.getDom())};b.getDom=function(){return a};return b}(b)};lineapp=lineapp||{};
lineapp.LineAppView=lineapp.LineAppView||function(b){return function(){var b=new lineapp.EventHub,a=$("<div></div>",{"class":"lineapp_lineappview_wrapper"});b.showWaiting=function(){};b.hideWaiting=function(){};b.showLogin=function(b){a.empty();a.append(b.getDom())};b.showGetInLineView=function(b){a.empty();a.append(b.getDom())};b.showInLineView=function(b){a.empty();a.append(b.getDom())};b.getDom=function(){return a};return b}(b)};if("undefined"===typeof console)var console={log:function(){},warn:function(){}};
var localurl=window.location.protocol+"//"+window.location.host,client=new lineapp.Client;function init(){lineapp.LineAppService.init({client:client});lineapp.Facebook.init({appId:"471521269618702",channelUrl:localurl+"/static/channel.html"});var b=lineapp.LineAppPresenter();$(body).append(b.getView().getDom());b.open()}init();
